Adviser - Dean - OSA

<!doctype html>
<html lang="en">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Image Queue Display</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    html, body {
      height: 100%;
      font-family: 'Outfit', sans-serif;
    }
    body {
      box-sizing: border-box;
    }
    .app-wrapper {
      height: 100%;
      width: 100%;
      overflow-y: auto;
    }
    .image-card {
      transition: all 0.3s ease;
      border: none;
    }
    .image-card:hover {
      transform: translateY(-4px);
    }
    .image-card img {
      aspect-ratio: 16 / 9;
      object-fit: cover;
    }
    .image-overlay {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: linear-gradient(to top, rgba(0,0,0,0.6), transparent);
      opacity: 0;
      transition: opacity 0.3s ease;
      display: flex;
      align-items: flex-end;
      padding: 1rem;
    }
    .image-card:hover .image-overlay {
      opacity: 1;
    }
    .image-container {
      position: relative;
      aspect-ratio: 16 / 9;
      overflow: hidden;
      cursor: pointer;
    }
    .slideshow-container {
      animation: fadeIn 0.5s ease;
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .loading-pulse {
      animation: pulse 1.5s infinite;
    }
    .btn-expiring {
      background-color: #7f1d1d !important;
      color: #fca5a5 !important;
    }
    .btn-normal {
      background-color: #1e3a5f !important;
      color: #93c5fd !important;
    }
    .header-container {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    @media (min-width: 576px) {
      .header-container {
        flex-direction: row;
        align-items: center;
        justify-content: space-between;
      }
    }
    .fullscreen-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: #000;
      z-index: 1050;
      display: none;
      align-items: center;
      justify-content: center;
      padding: 2rem;
    }
    .fullscreen-overlay.show {
      display: flex;
    }
    .fullscreen-image {
      max-height: 100%;
      max-width: 100%;
      object-fit: contain;
      border-radius: 0.5rem;
    }
    .close-btn {
      position: absolute;
      top: 1rem;
      right: 1rem;
      width: 3rem;
      height: 3rem;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.1);
      color: #f8fafc;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      transition: transform 0.2s;
      z-index: 10;
    }
    .close-btn:hover {
      transform: scale(1.1);
    }
    .slideshow-progress {
      position: absolute;
      top: 0;
      left: 0;
      height: 0.25rem;
      background: #6366f1;
      width: 0%;
      z-index: 10;
    }
    .slideshow-info {
      position: absolute;
      bottom: 1rem;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0.5rem;
      z-index: 10;
    }
    .slideshow-title {
      padding: 0.5rem 1.5rem;
      border-radius: 9999px;
      background: rgba(0, 0, 0, 0.7);
      color: #f8fafc;
      font-weight: 500;
    }
    .slideshow-counter {
      font-size: 0.875rem;
      color: #94a3b8;
    }
    #slideshow-view {
      position: fixed !important;
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 100% !important;
      margin: 0 !important;
      padding: 0 !important;
      z-index: 1060 !important;
      display: none !important;
      align-items: center !important;
      justify-content: center !important;
      background: #000;
      overflow: hidden;
      transition: background-color 0.5s ease;
    }
    #slideshow-view.show {
      display: flex !important;
    }
    .slideshow-img {
      width: 100%;
      height: 100%;
      object-fit: contain;
      position: relative;
      z-index: 5;
    }
  </style>
  <script src="https://cdn.tailwindcss.com/3.4.17" type="text/javascript"></script>
 </head>
 <body>
  <div id="app-wrapper" class="app-wrapper" style="background: #0f172a;"><!-- Main Interface -->
   <div id="main-interface" class="min-vh-100 p-4 p-md-5"><!-- Header -->
    <header class="mb-4 mb-md-5">
     <div class="container-lg">
      <div class="header-container">
       <div>
        <h1 id="gallery-title" class="display-5 fw-bold mb-2" style="color: #f8fafc;">Image Queue</h1>
        <p class="small mb-0" style="color: #94a3b8;">Images auto-delete after 1 week</p>
       </div>
       <div class="d-flex gap-2"><button id="add-btn" class="btn fw-medium" style="background: #6366f1; color: #f8fafc;"> ‚ûï Add Image </button> <button id="slideshow-btn" class="btn fw-medium" style="background: #1e293b; color: #f8fafc; border: 1px solid #334155;"> ‚ñ∂Ô∏è Slideshow </button>
       </div>
      </div>
     </div>
    </header><!-- Stats Bar -->
    <div class="container-lg mb-4">
     <div class="row p-3 rounded-3" style="background: #1e293b;">
      <div class="col-auto d-flex align-items-center gap-2"><span style="color: #94a3b8;">Total Images:</span> <span id="total-count" class="fw-semibold" style="color: #f8fafc;">0</span>
      </div>
      <div class="col-auto d-flex align-items-center gap-2"><span style="color: #94a3b8;">Expiring Soon:</span> <span id="expiring-count" class="fw-semibold" style="color: #fbbf24;">0</span>
      </div>
     </div>
    </div><!-- Image Grid -->
    <div class="container-lg">
     <div id="image-grid" class="row g-4"><!-- Images will be rendered here -->
     </div><!-- Empty State -->
     <div id="empty-state" class="text-center py-5 hidden">
      <div class="display-1 mb-3">
       üñºÔ∏è
      </div>
      <h2 class="h4 fw-semibold mb-2" style="color: #f8fafc;">No Images in Queue</h2>
      <p id="empty-message" style="color: #94a3b8;">Add images to start your slideshow display</p>
     </div>
    </div>
   </div><!-- Add Image Modal -->
   <div id="add-modal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
     <div class="modal-content" style="background: #1e293b; border: none;">
      <div class="modal-header" style="border-color: #334155;">
       <h5 class="modal-title fw-bold" style="color: #f8fafc;">Add New Image</h5><button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
       <form id="add-form">
        <div class="mb-4"><label for="image-url" class="form-label" style="color: #94a3b8;">Image URL</label> <input type="url" id="image-url" class="form-control" placeholder="https://example.com/image.jpg" required style="background: #0f172a; color: #f8fafc; border: 1px solid #334155;">
        </div>
        <div class="mb-4"><label for="image-title" class="form-label" style="color: #94a3b8;">Title (optional)</label> <input type="text" id="image-title" class="form-control" placeholder="Image title" style="background: #0f172a; color: #f8fafc; border: 1px solid #334155;">
        </div>
        <div class="d-flex gap-2"><button type="button" class="btn flex-grow-1" data-bs-dismiss="modal" style="background: #334155; color: #f8fafc;">Cancel</button> <button type="submit" id="submit-add" class="btn flex-grow-1" style="background: #6366f1; color: #f8fafc;">Add Image</button>
        </div>
       </form>
      </div>
     </div>
    </div>
   </div><!-- Delete Confirmation Modal -->
   <div id="delete-modal" class="modal fade" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
     <div class="modal-content" style="background: #1e293b; border: none;">
      <div class="modal-body text-center py-5">
       <div class="display-4 mb-3">
        üóëÔ∏è
       </div>
       <h5 class="modal-title fw-bold mb-2" style="color: #f8fafc;">Delete Image?</h5>
       <p class="mb-4" style="color: #94a3b8;">This action cannot be undone.</p>
       <div class="d-flex gap-2"><button type="button" class="btn flex-grow-1" data-bs-dismiss="modal" style="background: #334155; color: #f8fafc;">Cancel</button> <button type="button" id="confirm-delete" class="btn flex-grow-1" style="background: #ef4444; color: #f8fafc;">Delete</button>
       </div>
      </div>
     </div>
    </div>
   </div><!-- Fullscreen View -->
   <div id="fullscreen-view" class="fullscreen-overlay"><button type="button" class="close-btn">‚úï</button> <img id="fullscreen-image" src="" alt="" class="fullscreen-image">
    <div style="position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); padding: 0.5rem 1.5rem; border-radius: 9999px; background: rgba(0, 0, 0, 0.7);">
     <p id="fullscreen-title" class="mb-0 text-center fw-medium" style="color: #f8fafc;"></p>
    </div>
   </div><!-- Slideshow View -->
   <div id="slideshow-view">
    <div class="slideshow-progress" id="slideshow-progress"></div><img id="slideshow-image" src="" alt="" class="slideshow-img">
    <div class="slideshow-info">
     <p id="slideshow-title" class="mb-0 slideshow-title"></p>
     <p id="slideshow-counter" class="mb-0 slideshow-counter"></p>
    </div>
   </div><!-- Loading Overlay -->
   <div id="loading-overlay" class="position-fixed top-0 start-0 w-100 h-100 d-none d-flex align-items-center justify-content-center" style="background: rgba(15, 23, 42, 0.9); z-index: 2000;">
    <div class="text-center">
     <div class="loading-pulse display-1 mb-2">
      ‚è≥
     </div>
     <p style="color: #f8fafc;">Processing...</p>
    </div>
   </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Default configuration
    const defaultConfig = {
      gallery_title: 'Image Queue',
      empty_message: 'Add images to start your slideshow display',
      background_color: '#0f172a',
      surface_color: '#1e293b',
      text_color: '#f8fafc',
      primary_action_color: '#6366f1',
      secondary_text_color: '#94a3b8'
    };

    // App state
    let images = [];
    let deleteTargetId = null;
    let slideshowIndex = 0;
    let slideshowActive = false;
    let slideshowTimeout = null;
    let progressInterval = null;
    let progressValue = 0;
    let addModal = null;
    let deleteModal = null;

    // DOM Elements
    const elements = {
      appWrapper: document.getElementById('app-wrapper'),
      galleryTitle: document.getElementById('gallery-title'),
      emptyMessage: document.getElementById('empty-message'),
      imageGrid: document.getElementById('image-grid'),
      emptyState: document.getElementById('empty-state'),
      totalCount: document.getElementById('total-count'),
      expiringCount: document.getElementById('expiring-count'),
      addBtn: document.getElementById('add-btn'),
      slideshowBtn: document.getElementById('slideshow-btn'),
      addModalEl: document.getElementById('add-modal'),
      addForm: document.getElementById('add-form'),
      imageUrl: document.getElementById('image-url'),
      imageTitle: document.getElementById('image-title'),
      submitAdd: document.getElementById('submit-add'),
      deleteModalEl: document.getElementById('delete-modal'),
      confirmDelete: document.getElementById('confirm-delete'),
      fullscreenView: document.getElementById('fullscreen-view'),
      fullscreenImage: document.getElementById('fullscreen-image'),
      fullscreenTitle: document.getElementById('fullscreen-title'),
      slideshowView: document.getElementById('slideshow-view'),
      slideshowImage: document.getElementById('slideshow-image'),
      slideshowTitle: document.getElementById('slideshow-title'),
      slideshowCounter: document.getElementById('slideshow-counter'),
      slideshowProgress: document.getElementById('slideshow-progress'),
      loadingOverlay: document.getElementById('loading-overlay')
    };

    // Initialize modals
    function initModals() {
      addModal = new bootstrap.Modal(elements.addModalEl, { backdrop: 'static', keyboard: false });
      deleteModal = new bootstrap.Modal(elements.deleteModalEl, { backdrop: 'static', keyboard: false });
    }

    // Helper: Calculate days until expiry
    function getDaysUntilExpiry(expiresAt) {
      const now = new Date();
      const expiry = new Date(expiresAt);
      const diff = expiry - now;
      return Math.ceil(diff / (1000 * 60 * 60 * 24));
    }

    // Helper: Format date
    function formatDate(dateStr) {
      const date = new Date(dateStr);
      return date.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
    }

    // Helper: Show loading
    function showLoading() {
      elements.loadingOverlay.classList.remove('d-none');
      elements.loadingOverlay.classList.add('d-flex');
    }

    // Helper: Hide loading
    function hideLoading() {
      elements.loadingOverlay.classList.add('d-none');
      elements.loadingOverlay.classList.remove('d-flex');
    }

    // Extract dominant color from image
    function getDominantColor(imgElement, callback) {
      try {
        const canvas = document.createElement('canvas');
        const ctx = canvas.getContext('2d');
        
        canvas.width = 100;
        canvas.height = 100;
        
        ctx.drawImage(imgElement, 0, 0, 100, 100);
        
        const imageData = ctx.getImageData(0, 0, 100, 100);
        const data = imageData.data;
        
        let r = 0, g = 0, b = 0;
        
        for (let i = 0; i < data.length; i += 4) {
          r += data[i];
          g += data[i + 1];
          b += data[i + 2];
        }
        
        const pixelCount = data.length / 4;
        r = Math.floor(r / pixelCount);
        g = Math.floor(g / pixelCount);
        b = Math.floor(b / pixelCount);
        
        callback(`rgb(${r}, ${g}, ${b})`);
      } catch (e) {
        callback('rgba(0, 0, 0, 0.8)');
      }
    }

    // Render image card
    function createImageCard(image) {
      const daysLeft = getDaysUntilExpiry(image.expires_at);
      const isExpiringSoon = daysLeft <= 2;
      
      const col = document.createElement('div');
      col.className = 'col-12 col-sm-6 col-lg-4 col-xl-3';
      col.dataset.imageId = image.__backendId;
      
      const card = document.createElement('div');
      card.className = 'card image-card h-100';
      card.style.background = '#1e293b';
      card.style.border = 'none';
      
      card.innerHTML = `
        <div class="image-container" onclick="openFullscreen('${image.__backendId}')">
          <img src="${image.image_url}" alt="${image.title || 'Image'}" loading="lazy" class="card-img-top"
            onerror="this.style.background='#334155'; this.alt='Image unavailable'; this.src='data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üñºÔ∏è</text></svg>';">
          <div class="image-overlay">
            <span class="small fw-medium" style="color: #f8fafc;">Click to view</span>
          </div>
        </div>
        <div class="card-body">
          <h5 class="card-title text-truncate mb-2 fw-semibold" style="color: #f8fafc;">${image.title || 'Untitled'}</h5>
          <div class="d-flex align-items-center justify-content-between mb-3">
            <span class="small" style="color: #94a3b8;">Added ${formatDate(image.submitted_at)}</span>
            <span class="badge ${isExpiringSoon ? 'btn-expiring' : 'btn-normal'} text-nowrap">
              ${daysLeft}d left
            </span>
          </div>
          <button onclick="requestDelete('${image.__backendId}')" 
            class="btn btn-sm w-100" style="background: #334155; color: #f8fafc;">
            üóëÔ∏è Delete
          </button>
        </div>
      `;
      
      col.appendChild(card);
      return col;
    }

    // Render all images
    function renderImages() {
      const config = window.elementSdk?.config || defaultConfig;
      
      // Sort by date submitted (newest first) for display
      const sortedImages = [...images].sort((a, b) => 
        new Date(b.submitted_at) - new Date(a.submitted_at)
      );
      
      // Update counts
      elements.totalCount.textContent = images.length;
      const expiringSoon = images.filter(img => getDaysUntilExpiry(img.expires_at) <= 2).length;
      elements.expiringCount.textContent = expiringSoon;
      
      // Show/hide empty state
      if (images.length === 0) {
        elements.imageGrid.classList.add('hidden');
        elements.imageGrid.classList.add('d-none');
        elements.emptyState.classList.remove('hidden');
        elements.emptyState.classList.remove('d-none');
        elements.slideshowBtn.disabled = true;
        elements.slideshowBtn.style.opacity = '0.5';
      } else {
        elements.imageGrid.classList.remove('hidden');
        elements.imageGrid.classList.remove('d-none');
        elements.emptyState.classList.add('hidden');
        elements.emptyState.classList.add('d-none');
        elements.slideshowBtn.disabled = false;
        elements.slideshowBtn.style.opacity = '1';
      }
      
      // Clear and rebuild
      elements.imageGrid.innerHTML = '';
      sortedImages.forEach(image => {
        elements.imageGrid.appendChild(createImageCard(image));
      });
    }

    // Check and delete expired images
    async function checkExpiredImages() {
      const now = new Date();
      const expiredImages = images.filter(img => new Date(img.expires_at) <= now);
      
      for (const img of expiredImages) {
        const result = await window.dataSdk.delete(img);
        if (result.isOk) {
          console.log('Auto-deleted expired image:', img.title);
        }
      }
    }

    // Open fullscreen view
    window.openFullscreen = function(imageId) {
      const image = images.find(img => img.__backendId === imageId);
      if (!image) return;
      
      elements.fullscreenImage.src = image.image_url;
      elements.fullscreenTitle.textContent = image.title || 'Untitled';
      elements.fullscreenView.classList.add('show');
      document.body.style.overflow = 'hidden';
    };

    // Close fullscreen
    function closeFullscreen() {
      elements.fullscreenView.classList.remove('show');
      document.body.style.overflow = '';
    }

    // Start slideshow
    function startSlideshow() {
      if (images.length === 0) return;
      
      slideshowActive = true;
      slideshowIndex = 0;
      elements.slideshowView.classList.add('show');
      document.body.style.overflow = 'hidden';
      
      updateSlideshowDisplay();
      scheduleNextSlide();
    }

    // Schedule next slide
    function scheduleNextSlide() {
      if (!slideshowActive) return;

      // Clear existing timeout and progress
      if (slideshowTimeout) clearTimeout(slideshowTimeout);
      if (progressInterval) clearInterval(progressInterval);
      
      progressValue = 0;
      elements.slideshowProgress.style.width = '0%';
      
      // Update progress bar every 100ms for 10 seconds
      progressInterval = setInterval(() => {
        if (slideshowActive) {
          progressValue += 1;
          elements.slideshowProgress.style.width = `${Math.min(progressValue, 100)}%`;
        }
      }, 100);
      
      // Advance to next image after 10 seconds
      slideshowTimeout = setTimeout(() => {
        if (slideshowActive && images.length > 0) {
          slideshowIndex = (slideshowIndex + 1) % images.length;
          updateSlideshowDisplay();
          scheduleNextSlide();
        }
      }, 10000);
    }

    // Update slideshow display
    function updateSlideshowDisplay() {
      const sortedImages = [...images].sort((a, b) => 
        new Date(a.submitted_at) - new Date(b.submitted_at)
      );
      
      if (sortedImages.length === 0) return;
      
      const image = sortedImages[slideshowIndex];
      elements.slideshowImage.src = image.image_url;
      elements.slideshowTitle.textContent = image.title || 'Untitled';
      elements.slideshowCounter.textContent = `${slideshowIndex + 1} of ${sortedImages.length}`;
      
      // Extract and apply dominant color from image
      const img = new Image();
      img.crossOrigin = 'anonymous';
      img.onload = function() {
        getDominantColor(img, (color) => {
          if (slideshowActive) {
            elements.slideshowView.style.backgroundColor = color;
          }
        });
      };
      img.onerror = function() {
        // Fallback color if image fails to load
        if (slideshowActive) {
          elements.slideshowView.style.backgroundColor = '#000';
        }
      };
      img.src = image.image_url;
    }

    // Close slideshow
    function closeSlideshow() {
      slideshowActive = false;
      if (slideshowTimeout) clearTimeout(slideshowTimeout);
      if (progressInterval) clearInterval(progressInterval);
      slideshowTimeout = null;
      progressInterval = null;
      elements.slideshowView.classList.remove('show');
      document.body.style.overflow = '';
    }

    // Request delete
    window.requestDelete = function(imageId) {
      deleteTargetId = imageId;
      deleteModal.show();
    };

    // Confirm delete
    async function confirmDelete() {
      if (!deleteTargetId) return;
      
      const image = images.find(img => img.__backendId === deleteTargetId);
      if (!image) return;
      
      showLoading();
      deleteModal.hide();
      
      const result = await window.dataSdk.delete(image);
      hideLoading();
      
      if (!result.isOk) {
        console.error('Failed to delete image:', result.error);
      }
      
      deleteTargetId = null;
    }

    // Handle add form submit
    async function handleAddSubmit(e) {
      e.preventDefault();
      
      if (images.length >= 999) {
        addModal.hide();
        const warning = document.createElement('div');
        warning.className = 'position-fixed top-0 start-50 translate-middle-x p-3 rounded-2';
        warning.style.background = '#ef4444';
        warning.style.color = '#fff';
        warning.style.zIndex = '2001';
        warning.textContent = '‚ö†Ô∏è Maximum limit of 999 images reached. Please delete some images first.';
        document.body.appendChild(warning);
        setTimeout(() => warning.remove(), 4000);
        return;
      }
      
      const url = elements.imageUrl.value.trim();
      const title = elements.imageTitle.value.trim();
      
      if (!url) return;
      
      showLoading();
      addModal.hide();
      
      const now = new Date();
      const expiresAt = new Date(now.getTime() + 7 * 24 * 60 * 60 * 1000);
      
      const result = await window.dataSdk.create({
        image_url: url,
        title: title || 'Untitled',
        submitted_at: now.toISOString(),
        expires_at: expiresAt.toISOString()
      });
      
      hideLoading();
      
      if (result.isOk) {
        elements.imageUrl.value = '';
        elements.imageTitle.value = '';
      } else {
        console.error('Failed to add image:', result.error);
      }
    }

    // Data handler
    const dataHandler = {
      onDataChanged(data) {
        images = data;
        renderImages();
        checkExpiredImages();
      }
    };

    // Config change handler
    async function onConfigChange(config) {
      elements.galleryTitle.textContent = config.gallery_title || defaultConfig.gallery_title;
      elements.emptyMessage.textContent = config.empty_message || defaultConfig.empty_message;
      elements.appWrapper.style.background = config.background_color || defaultConfig.background_color;
    }

    // Map to capabilities
    function mapToCapabilities(config) {
      return {
        recolorables: [
          {
            get: () => config.background_color || defaultConfig.background_color,
            set: (value) => {
              config.background_color = value;
              window.elementSdk.setConfig({ background_color: value });
            }
          },
          {
            get: () => config.surface_color || defaultConfig.surface_color,
            set: (value) => {
              config.surface_color = value;
              window.elementSdk.setConfig({ surface_color: value });
            }
          },
          {
            get: () => config.text_color || defaultConfig.text_color,
            set: (value) => {
              config.text_color = value;
              window.elementSdk.setConfig({ text_color: value });
            }
          },
          {
            get: () => config.primary_action_color || defaultConfig.primary_action_color,
            set: (value) => {
              config.primary_action_color = value;
              window.elementSdk.setConfig({ primary_action_color: value });
            }
          },
          {
            get: () => config.secondary_text_color || defaultConfig.secondary_text_color,
            set: (value) => {
              config.secondary_text_color = value;
              window.elementSdk.setConfig({ secondary_text_color: value });
            }
          }
        ],
        borderables: [],
        fontEditable: undefined,
        fontSizeable: undefined
      };
    }

    // Map to edit panel values
    function mapToEditPanelValues(config) {
      return new Map([
        ['gallery_title', config.gallery_title || defaultConfig.gallery_title],
        ['empty_message', config.empty_message || defaultConfig.empty_message]
      ]);
    }

    // Event listeners
    elements.addBtn.addEventListener('click', () => addModal.show());
    elements.addForm.addEventListener('submit', handleAddSubmit);
    elements.slideshowBtn.addEventListener('click', startSlideshow);
    elements.confirmDelete.addEventListener('click', confirmDelete);

    // Fullscreen close button
    elements.fullscreenView.querySelector('.close-btn').addEventListener('click', closeFullscreen);

    // Keyboard navigation
    document.addEventListener('keydown', (e) => {
      if (elements.slideshowView.classList.contains('show')) {
        if (e.key === 'Escape') closeSlideshow();
      }
      if (elements.fullscreenView.classList.contains('show')) {
        if (e.key === 'Escape') closeFullscreen();
      }
    });

    // Initialize
    async function init() {
      initModals();
      
      if (window.elementSdk) {
        window.elementSdk.init({
          defaultConfig,
          onConfigChange,
          mapToCapabilities,
          mapToEditPanelValues
        });
      }
      
      const result = await window.dataSdk.init(dataHandler);
      if (!result.isOk) {
        console.error('Failed to initialize Data SDK');
      }
      
      setInterval(checkExpiredImages, 60000);
    }

    init();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9cd0e86c83c5b430',t:'MTc3MDk0OTg2OS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>